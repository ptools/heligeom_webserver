<!-- List of reusable macros for the result page. Avoid code duplication. -->

<!-- Macro to display input parameters -->
{% macro display_input_params(data) -%}
<div class="row">
  <div class="col s12 m6">
      <h6>Input Parameters</h6>
      <ul>
        <li>Input structure: <b>{{data.pdb_input}}</b></li>
        <li><b>Monomer 1</b>
            <ul>
            <li>Chain : <b>{% if data.chain1_id %} {{ data.chain1_id }} {% else %} Unspecified{%
                endif %}</b></li>
            <li>Residue range: <b>{% if data.res_range1 %} {{ data.res_range1 }} {% else %}
                Unspecified{% endif %}</b></li>
            <li>Core region: <b>{% if data.core_filter1 == "all" %} All Residues {% else %}
              {{ data.core_region1 }}{% endif %}</b></li>
            </ul>
        </li>
        <li><b>Monomer 2</b>
          <ul>
          <li>Chain : <b>{% if data.chain2_id %} {{ data.chain2_id }} {% else %} Unspecified{%
              endif %}</b></li>
          <li>Residue range: <b>{% if data.res_range2 %} {{ data.res_range2 }} {% else %}
              Unspecified{% endif %}</b></li>
          <li>Core region: <b>{% if data.core_filter2 == "all" %} All Residues {% else %}
            {{ data.core_region2 }}{% endif %}</b></li>
          </ul>
        </li>
      </ul>
  </div>
</div>
{%- endmacro %}

<!-- Macro to display screw parameters -->
{% macro display_screw_params(data) -%}
<table class="striped">
  <tbody>
    <tr>
      <td><b>Pitch</b></td>
      <td>{{ data.pitch }} &#8491;</td>
    </tr>
    <tr>
      <td><b>Monomers per turn</b></td>
      <td>{{ data.nb_monomers }}</td>
    </tr>
    <tr>
      <td><b>Handedness</b></td>
      <td>{{ data.direction | capitalize }}</td>
    </tr>
    <tr>
      <td><b>Distance minimal between screw axis and oligomer (IntR)</b></td>
      <td>{{ data.dmin }}</td>
    </tr>
    <tr>
      <td><b>Distance maximal between screw axis and oligomer (ExtR)</b></td>
      <td>{{ data.dmax }}</td>
  </tbody>
</table>
{%- endmacro %}

<!-- Macro to display axis parameters -->
{% macro display_axis_params(data) -%}
<table class="striped">
  <tbody>
    <tr>
      <td><b>Axis Point (O)</b></td>
      <td>{{ data.axis_point|join(" ") }}</td>
    </tr>
    <tr>
      <td><b>Rotation Angle (&theta;) </b></td>
      <td>{{ data.rotation_angle_deg }}&#176;</td>
    </tr>
    <tr>
      <td><b>Translation (trans) </b></td>
      <td> {{ data.translation }} &#8491;</td>
    </tr>
  </tbody>
</table>
{%- endmacro %}

{% macro display_rmsd(data) -%}
<p class="center" style="margin-top: 20px;">
  <b>RMSD:</b> {{ data.rmsd }}
</p>
{%- endmacro %}


<!-- Macro to display construction form -->
{% macro display_construction_form(form, offset) -%}
<div class="row">
  <div class="col s12" style="margin-bottom: 10px;">
    <p>From the helical parameters calculated from the 2 monomers, you can construct a filament made of
      copies of Monomer 1.</p>
    <p></p>
  </div>
  <div class="input-field col s12 m3 {{ offset }}">
    {{ form.n_mer }}
    <label>Number of Monomers (100 maximum)</label>
    {% if form.n_mer.errors %}
    <span class="helper-text error-input">{{form.n_mer.errors}}</span>
    {% else %}
    <span class="helper-text" data-error="Number only" data-success="">Number only</span>
    {% endif %}
  </div>
  <div class="input-field col s12 m3">
    <label for="z_align">
      {{ form.z_align }}
      <span>Alignment on Z-axis?</span>
    </label>
  </div>
</div>
<div class="row">
  <button class="waves-effect btn lbt-bleu" type="submit" name="action"
    onclick="load('loading_icon')">Construct<i class="material-icons right">send</i></button>
</div>
<div class="row hide" id="loading_icon">
  <div class="col s4 push-s4">
    <div class="progress">
      <div class="indeterminate"></div>
    </div>
  </div>
</div>
{%- endmacro %}


<!-- Macro to display the download button for one oligomer -->
{% macro button_download_oligomer(results_id, oligo_filename) -%}
<p class="center-align">
  <a class="waves-effect btn-small orange darken-4" data-tooltip="Download PDB file"
    href="{{ url_for('heligeom_bp.download', results_id=results_id, filename=oligo_filename)}}">
    <i class="material-icons right">file_download</i>
      <span class="hide-on-med-and-down">Download Oligomer</span>
  </a>
</p>
{%- endmacro %}



{% macro molstar_buttons(construct_data)-%}
<div class="row" style="margin-bottom: 5px;">
  <button class="waves-effect waves-light btn-small visu_button grey lighten-5  grey-text text-darken-3"
    onclick="viewerInstance.visual.select({ data: [
      { {{ construct_data.select_monomer1 }} }
      ],
      nonSelectedColor: {r:255,g:255,b:255}})"
  >
  Select 1st Monomer
  </button>
  <button class="waves-effect waves-light btn-small visu_button grey lighten-5  grey-text text-darken-3"
    onclick="viewerInstance.visual.select({ data: [
      { {{ construct_data.select_monomer2 }} }
      ],
      nonSelectedColor: {r:255,g:255,b:255}})"
  >
  Select 2nd Monomer
  </button>
  <button class="waves-effect waves-light btn-small visu_button grey lighten-5  grey-text text-darken-3"
    onclick="viewerInstance.visual.select(
      {data: [ {{ construct_data.select_interface }} ],
      nonSelectedColor: {r:255,g:255,b:255}})"
  >
  Select & Focus on residus at the interface
  </button>
</div>
<div class="row" style="margin-bottom: 5px;">
  <button class="waves-effect waves-light btn-small visu_button grey lighten-5  grey-text text-darken-3" onclick="viewerInstance.visual.clearSelection()">Clear Selection</button>
  <button class="waves-effect waves-light btn-small visu_button grey lighten-5  grey-text text-darken-3" onclick="viewerInstance.visual.reset({ camera: true, theme: true, selectColor:true})">Reset Camera</button>
</div>
{%- endmacro %}



<!-- Macro to display the LiteMol plugin for one oligomer -->
{% macro PDEMolstar_plugin(id, results_id, oligo_filename) -%}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pdbe-molstar@3.3.0/build/pdbe-molstar-light.css"
type="text/css" />
<script src="https://cdn.jsdelivr.net/npm/pdbe-molstar@3.3.0/build/pdbe-molstar-plugin.js"></script>

<div id="{{ id }}"></div>

<script type="text/javascript">
  //Create plugin instance
  const viewerInstance = new PDBeMolstarPlugin();

  //Set options (Checkout available options list in the documentation)
  const options = {
    customData: { url: "{{ url_for('heligeom_bp.download', results_id=results_id, filename=oligo_filename) }}", format: 'pdb'},
    hideControls: true,
    bgColor: {r:250, g:250, b:250},
    landscape: true,
    sequencePanel: true,
    hideCanvasControls: ['animation']
  }

  //Get element from HTML/Template to place the viewer
  const viewerContainer = document.getElementById("{{ id }}");

  //Call render method to display the 3D view
  viewerInstance.render(viewerContainer, options);
</script>
{%- endmacro %}
